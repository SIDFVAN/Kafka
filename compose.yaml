version: "3"
services:
  kafka1:
    image: frankv72/bp2024:1.2
    hostname: kafka1
    container_name: kafka1
    ports:
       - 9092:9092
    command:  /opt/kafka/bin/kafka-server-start.sh /opt/kafka/config/kraft/server.properties --override node.id=1 --override num.network.threads=3 --override num.io.threads=8 --override process.roles=broker,controller  --override listeners=INTERNAL://kafka1:29092,CONTROLLER://kafka1:29093,EXTERNAL://0.0.0.0:9092  --override advertised.listeners=INTERNAL://kafka1:29092,EXTERNAL://localhost:9092 --override listener.security.protocol.map=CONTROLLER:SASL_PLAINTEXT,INTERNAL:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT  --override controller.listener.names=CONTROLLER --override controller.quorum.voters=1@kafka1:29093,2@kafka2:29093 --override inter.broker.listener.name=INTERNAL --override sasl.enabled.mechanisms=PLAIN --override sasl.mechanism.controller.protocol=PLAIN --override sasl.mechanism.inter.broker.protocol=PLAIN --override authorizer.class.name=org.apache.kafka.metadata.authorizer.StandardAuthorizer --override allow.everyone.if.no.acl.found=false --override super.users=User:admin --override delete.topic.enable=true --override socket.send.buffer.bytes=1048576 --override socket.receive.buffer.bytes=1048576 --override socket.request.max.bytes=104857600 --override num.partitions=3 --override default.replication.factor=2 --override min.insync.replicas=2 --override log.retention.hours=168 --override log.segment.bytes=1073741824 --override log.retention.check.interval.ms=300000 --override auto.create.topics.enable=true --override unclean.leader.election.enable=false

  kafka2:
    image: frankv72/bp2024:1.2
    hostname: kafka2
    container_name: kafka2
    ports:
       - 9093:9093
    command: >
        bash -c "sed -i -e 's/node.id=1/node.id=2/g' /tmp/kraft-combined-logs/meta.properties &&
        && /opt/kafka/bin/kafka-storage.sh format -t azgB17mFT8if8tYAPn4y6Q -c /opt/kafka/config/kraft/server.properties &&
        /opt/kafka/bin/kafka-server-start.sh /opt/kafka/config/kraft/server.properties --override node.id=2 --override num.network.threads=3 --override num.io.threads=8 --override process.roles=broker,controller  --override listeners=INTERNAL://kafka2:29092,CONTROLLER://kafka2:29093,EXTERNAL://0.0.0.0:9093  --override advertised.listeners=INTERNAL://kafka2:29092,EXTERNAL://localhost:9093 --override listener.security.protocol.map=CONTROLLER:SASL_PLAINTEXT,INTERNAL:SASL_PLAINTEXT,EXTERNAL:SASL_PLAINTEXT  --override controller.listener.names=CONTROLLER --override controller.quorum.voters=1@kafka1:29093,2@kafka2:29093 --override inter.broker.listener.name=INTERNAL --override sasl.enabled.mechanisms=PLAIN --override sasl.mechanism.controller.protocol=PLAIN --override sasl.mechanism.inter.broker.protocol=PLAIN --override authorizer.class.name=org.apache.kafka.metadata.authorizer.StandardAuthorizer --override allow.everyone.if.no.acl.found=false --override super.users=User:admin --override delete.topic.enable=true --override socket.send.buffer.bytes=1048576 --override socket.receive.buffer.bytes=1048576 --override socket.request.max.bytes=104857600 --override num.partitions=3 --override default.replication.factor=2 --override min.insync.replicas=2 --override log.retention.hours=168 --override log.segment.bytes=1073741824 --override log.retention.check.interval.ms=300000 --override auto.create.topics.enable=true --override unclean.leader.election.enable=false"

 
